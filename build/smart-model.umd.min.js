/*! SmartModel v0.2.13 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SmartModel={})}(this,(function(e){"use strict";class t extends Error{constructor(e){super(e.message),Object.assign(this,e)}}function r(e){return void 0===e}function n(e){return""===e||null===e||r(e)}function o(e){return"function"==typeof e}function s(e){return[].concat([],e)}function c(e,t,r){const o=[];return e.required&&n(r)?(o.push({message:`Invalid value 'required' on property '${t}'`,code:"required"}),o):(void 0===r||(!e.type||!e.required&&n(r)||s(e.type).some((e=>function(e,t){return"object"==typeof t&&(t=Object),!function(e){return e.toString().startsWith("class")}(t)&&typeof e==typeof t()||e instanceof t||typeof e==typeof t}(r,e)))||o.push({message:`Invalid type '${typeof r}' on property '${t}'`,code:"type"}),e.rule&&Object.keys(e.rule).forEach((n=>{(0,e.rule[n])(r)&&o.push({message:`Invalid value '${n}' on property '${t}'`,code:n})}))),o)}function i(e={},t,r){if(!e.type)return!1;const n=e.type.prototype instanceof u&&e.type,o="object"==typeof e.type&&e.type;return!(!n&&!o)&&(n||u.create(t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").match(/[a-z]+/gi).map((e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())).join(""),o,r))}class u extends class{constructor(e,r){return new Proxy(this,{set(n,s,u){let f=e[s];const a=n[s],p=(l=u,d=a,!(JSON.stringify(l)===JSON.stringify(d)));var l,d;const y=i(f,s,r);function h(t,r){return Reflect.apply(t,n,r||[s,u,a,e])}if(!f){if(r.strict)return!0;f={}}if(h(n.onBeforeSet),p&&h(n.onBeforeUpdate),o(f.transform)&&(u=h(f.transform,[u,e])),r.exceptions){const e=c(f,s,u);if(e.length)throw new t({message:e[0].message,property:s,code:e[0].code,source:n.constructor.name})}return y&&(u=new y(u instanceof Object?u:{})),n[s]=u,h(n.onSet),p&&h(n.onUpdate),!0},get(t,r){const n=e[r];let s=t[r];if(!n)return t[r];function c(n,o){return Reflect.apply(n,t,o||[r,s,e])}return c(t.onBeforeGet),o(n)&&(s=c(n,[t,e])),o(n.format)&&(s=c(n.format,[s,e])),c(t.onGet),s},deleteProperty(r,n){const o=r[n];function s(t,s){return Reflect.apply(t,r,s||[n,o,e])}if(e[n].required)throw new t({message:`Invalid delete on required propery ${n}`,property:n,code:"required"});return s(r.onBeforeDelete),Reflect.deleteProperty(r,n),s(r.onDelete),s(r.onUpdate),!0}})}}{constructor(e={},t={},n){super(e,n),Object.keys(e).forEach((n=>{r(t[n])&&(e[n].default?this[n]=e[n].default:this[n]=t[n])})),this.feed(t)}feed(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))}onBeforeGet(){}onBeforeSet(){}onBeforeUpdate(){}onDelete(){}onGet(){}onBeforeDelete(){}onSet(){}onUpdate(){}}u.settings={strict:!1,exceptions:!0},u.create=function(e,t,r,n){r=Object.assign({},u.settings,r);const o={[e]:class extends u{constructor(e){super(t,e,r)}}}[e];return o.checkErrors=function(e,n){const o={};return Object.keys(t).forEach((u=>{let f;const a=e[u],p=t[u],l=i(p,u,r);l&&(f=l.checkErrors(a,n));let d=c(p,u,a);f?o[u]=f:d.length&&(n&&(d=d.filter((e=>!s(n).includes(e.code)))),d.length&&(o[u]=d))})),!!Object.keys(o).length&&o},o.hydrate=function(e){return t=e,Array.isArray(t)?e.map((e=>new o(e))):new o(e);var t},Object.assign(o.prototype,n),o.schema=t,o},e.default=u,Object.defineProperty(e,"__esModule",{value:!0})}));
