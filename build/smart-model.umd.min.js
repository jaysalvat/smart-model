/*! smartModel v0.2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).smartModel={})}(this,(function(e){"use strict";function t(e){return""===e||null==e}function r(e){return"function"==typeof e}function n(e){return Array.isArray(e)}function o(e){return e?JSON.parse(JSON.stringify(e)):e}function s(e,r,o){const s=[];if(e.required&&t(o))return s.push({message:`Invalid value 'required' on property '${r}'`,code:"required"}),s;if(void 0===o)return s;if(e.type){let c;const i=n(e.type)?e.type:[e.type];c=!(e.required||!t(o))||i.some((e=>typeof o==typeof e()||o instanceof e)),c||s.push({message:`Invalid type '${typeof o}' on property '${r}'`,code:"type"})}return e.rule&&Object.keys(e.rule).forEach((t=>{(0,e.rule[t])(o)&&s.push({message:`Invalid value '${t}' on property '${r}'`,code:t})})),s}class c extends Error{constructor(e){super(e.message),Object.assign(this,e)}}class i{constructor(e={},t={}){this.schema=e,this.settings=t}set(e,t,r){const n=this.schema,i=o(e[t]),u=(f=r,a=i,!(JSON.stringify(f)===JSON.stringify(a)));var f,a;let p=n[t];function d(o){return Reflect.apply(o,e,[t,r,i,n])}if(this.settings.strict&&!p)return!0;if(p={},p.transform&&(r=p.transform(r)),d(e.onBeforeSet),u&&d(e.onBeforeUpdate),this.settings.exceptions){const e=s(p,t,r);e.length&&e.forEach((e=>{throw new c({message:e.message,property:t,code:e.code})}))}return e[t]=r,d(e.onSet),u&&d(e.onUpdate),!0}get(e,t){const n=this.schema,o=n[t];let s=e[t];if(!o)return e[t];function c(t,r){return Reflect.apply(t,e,r)}return c(e.onBeforeGet,[t,s,n]),r(o)&&(s=c(o,[e])),r(o.format)&&(s=c(o.format,[s,e])),c(e.onGet,[t,s,n]),s}deleteProperty(e,t){const r=o(e[t]),n=this.schema;function s(t,r){return Reflect.apply(t,e,r)}if(n[t].required)throw new c({message:`Invalid delete on required propery ${t}`,property:t,code:"delete"});return Reflect.deleteProperty(e,t),s(e.onDelete,[t,r,n]),s(e.onUpdate,[t,undefined,n]),!0}}class u{constructor(e={},t={}){Object.keys(e).forEach((t=>{e[t].default&&(this[t]=e[t].default)})),this.feed(t)}feed(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))}onSet(){}onGet(){}onDelete(){}onUpdate(){}onBeforeSet(){}onBeforeGet(){}onBeforeUpdate(){}}u.settings={strict:!1,exceptions:!0},u.create=function(e,t,r,n={}){n=Object.assign({},u.settings,n);const o={[e]:class extends u{constructor(e){return super(t,e),new Proxy(this,new i(t,n))}}}[e];return o.checkErrors=function(e,r){return u.checkErrors(t,e,r)},Object.assign(o.prototype,r),o},u.checkErrors=function(e,t,r){const n={};return Object.keys(e).forEach((o=>{const c=t[o];let i=s(e[o],o,c);i.length&&(r&&(i=i.filter((e=>!function(e){return[].concat([],e)}(r).includes(e.code)))),i.length&&(n[o]=i))})),!!Object.keys(n).length&&n},u.hydrate=function(e,t){return n(t)?t.map((t=>new e(t))):new e(t)},e.default=u,Object.defineProperty(e,"__esModule",{value:!0})}));
