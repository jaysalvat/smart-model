/*! SmartModel v0.3.2 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).SmartModel=t()}(this,(function(){"use strict";function e(e){return Array.isArray(e)}function t(e){return void 0===e}function r(e){return""===e||null===e||t(e)}function n(e){return"function"==typeof e}function o(e){return e&&e.toString().startsWith("class")}function s(e){return e&&"[object Object]"===e.toString()}function c(e,t){return t=Object.assign({},e,t),Object.keys(e).forEach((r=>{s(e[r])&&s(t[r])&&(t[r]=Object.assign({},e[r],c(e[r],t[r])))})),t}function i(e){return[].concat([],e)}class u extends Error{constructor(e){super(e.message),Object.assign(this,e)}}function f(t,n,s,c,u={}){const f=[];return!u.strict||t&&Object.keys(t).length||f.push({message:`Property "${n}" can't be set in strict mode`,code:"strict"}),t.required&&r(s)?(f.push({message:`Property "${n}" is "required"`,code:"required"}),f):t.readonly&&!c?(f.push({message:`Property '${n}' is 'readonly'`,code:"readonly"}),f):(void 0===s||(!t.type||!t.required&&r(s)||i(t.type).some((t=>function(t,r){const n=r&&r.toString().match(/^\s*function (\w+)/),s=(n?n[1]:"object").toLowerCase();if("date"===s&&t instanceof r)return!0;if("array"===s&&e(t))return!0;if("object"===s){if(o(r)&&t instanceof r)return!0;if(!o(r)&&typeof t===s)return!0}else if(typeof t===s)return!0;return!1}(s,t)))||f.push({message:`Property "${n}" has an invalid type "${typeof s}"`,code:"type"}),t.rule&&Object.keys(t.rule).forEach((e=>{(0,t.rule[e])(s)&&f.push({message:`Property "${n}" breaks the "${e}" rule`,code:"rule:"+e})}))),f)}function a(e={},t,r){if(!e.type)return!1;const n=e.type.prototype instanceof p&&e.type,o=!!s(e.type)&&e.type;return!(!n&&!o)&&(n||p.create(t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").match(/[a-z]+/gi).map((e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())).join(""),o,r))}u.throw=function(e,t,r,n,o){const c=t.split(":")[0];if(!0===e.exceptions||s(e.exceptions)&&e.exceptions[c])throw new u({message:r,property:n,code:t,source:o&&o.constructor.name})};class p extends class{constructor(e,r){return new Proxy(this,{set(o,s,c){const i=e[s]||{},p=o[s],l=t(p),d=!(l||(y=c,h=p,JSON.stringify(y)===JSON.stringify(h)));var y,h;const g=a(i,s,r);function m(t,r){return Reflect.apply(t,o,r||[s,c,p,e])}if(m(o.onBeforeSet),d&&m(o.onBeforeUpdate),n(i.transform)&&(c=m(i.transform,[c,e])),r.exceptions){const e=f(i,s,c,l,r);e.length&&u.throw(r,e[0].code,e[0].message,s,o)}return!(!r.strict||i&&Object.keys(i).length)||(g&&(c=new g(c instanceof Object?c:{})),o[s]=c,m(o.onSet),d&&m(o.onUpdate),!0)},get(t,r){const o=e[r];let s=t[r];if(!o)return t[r];function c(n,o){return Reflect.apply(n,t,o||[r,s,e])}return c(t.onBeforeGet),n(o)&&(s=c(o,[t,e])),n(o.format)&&(s=c(o.format,[s,e])),c(t.onGet),s},deleteProperty(t,r){const n=t[r];function o(o,s){return Reflect.apply(o,t,s||[r,n,e])}if(e[r].required)throw new u({message:`Invalid delete on required propery ${r}`,property:r,code:"required"});return o(t.onBeforeDelete),Reflect.deleteProperty(t,r),o(t.onDelete),o(t.onUpdate),!0}})}}{constructor(e={},r={},n){super(e,n),Object.keys(e).forEach((n=>{t(r[n])&&(this[n]=t(e[n].default)?r[n]:e[n].default)})),this.feed(r)}feed(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))}onBeforeGet(){}onBeforeSet(){}onBeforeUpdate(){}onDelete(){}onGet(){}onBeforeDelete(){}onSet(){}onUpdate(){}}return p.settings={strict:!1,exceptions:{readonly:!1,required:!0,rule:!0,strict:!1,type:!0}},p.create=function(t,r,n,o){n=c(p.settings,n);const s={[t]:class extends p{constructor(e){super(r,e,n)}}}[t];return s.checkErrors=function(e,t){const o={};return Object.keys(r).forEach((s=>{let c;const u=e[s],p=r[s],l=a(p,s,n);l&&(c=l.checkErrors(u,t));let d=f(p,s,u,!1);c?o[s]=c:d.length&&(t&&(d=d.filter((e=>!i(t).includes(e.code)))),d.length&&(o[s]=d))})),!!Object.keys(o).length&&o},s.hydrate=function(t){return e(t)?t.map((e=>new s(e))):new s(t)},Object.assign(s.prototype,o),s.schema=r,s},p}));
