/*! smartModel v0.2.1 */
function e(e){return""===e||null==e}function t(e){return"function"==typeof e}function r(e){return Array.isArray(e)}function n(e){return e?JSON.parse(JSON.stringify(e)):e}function o(t,n,o){const s=[];if(t.required&&e(o))return s.push({message:`Invalid value 'required' on property '${n}'`,code:"required"}),s;if(void 0===o)return s;if(t.type){let c;const i=r(t.type)?t.type:[t.type];c=!(t.required||!e(o))||i.some((e=>typeof o==typeof e()||o instanceof e)),c||s.push({message:`Invalid type '${typeof o}' on property '${n}'`,code:"type"})}return t.rule&&Object.keys(t.rule).forEach((e=>{(0,t.rule[e])(o)&&s.push({message:`Invalid value '${e}' on property '${n}'`,code:e})})),s}class s extends Error{constructor(e){super(e.message),Object.assign(this,e)}}class c{constructor(e={},t={}){this.schema=e,this.settings=t}set(e,t,r){const c=this.schema,i=n(e[t]),u=(f=r,a=i,!(JSON.stringify(f)===JSON.stringify(a)));var f,a;const p=c[t];function l(n){return Reflect.apply(n,e,[t,r,i,c])}if(!p)return this.settings.strict||(e[t]=r),!0;if(l(e.onBeforeSet),u&&l(e.onBeforeUpdate),p.transform&&(r=p.transform(r)),this.settings.exceptions){const e=o(p,t,r);e.length&&e.forEach((e=>{throw new s({message:e.message,property:t,code:e.code})}))}return e[t]=r,l(e.onSet),u&&l(e.onUpdate),!0}get(e,r){const n=this.schema,o=n[r];let s=e[r];if(!o)return e[r];function c(t,r){return Reflect.apply(t,e,r)}return c(e.onBeforeGet,[r,s,n]),t(o)&&(s=c(o,[e])),t(o.format)&&(s=c(o.format,[s,e])),c(e.onGet,[r,s,n]),s}deleteProperty(e,t){const r=n(e[t]),o=this.schema;function c(t,r){return Reflect.apply(t,e,r)}if(o[t].required)throw new s({message:`Invalid delete on required propery ${t}`,property:t,code:"delete"});return Reflect.deleteProperty(e,t),c(e.onDelete,[t,r,o]),c(e.onUpdate,[t,undefined,o]),!0}}class i{constructor(e={},t={}){Object.keys(e).forEach((t=>{e[t].default&&(this[t]=e[t].default)})),this.feed(t)}feed(e){Object.keys(e).forEach((t=>{this[t]=e[t]}))}onSet(){}onGet(){}onDelete(){}onUpdate(){}onBeforeSet(){}onBeforeGet(){}onBeforeUpdate(){}}i.settings={strict:!1,exceptions:!0},i.create=function(e,t,n,s={}){s=Object.assign({},i.settings,s);const u={[e]:class extends i{constructor(e){return super(t,e),new Proxy(this,new c(t,s))}}}[e];return u.checkErrors=function(e,r){const n={};return Object.keys(t).forEach((s=>{const c=e[s];let i=o(t[s],s,c);i.length&&(r&&(i=i.filter((e=>!function(e){return[].concat([],e)}(r).includes(e.code)))),i.length&&(n[s]=i))})),!!Object.keys(n).length&&n},u.hydrate=function(e){return r(e)?e.map((e=>new u(e))):new u(e)},Object.assign(u.prototype,n),u};export default i;
