/*! SmartModel v0.3.2 */
function e(e){return Array.isArray(e)}function t(e){return void 0===e}function r(e){return"function"==typeof e}function n(e){return e&&e.toString().startsWith("class")}function o(e){return e.prototype instanceof l||e instanceof l}function s(e){return e&&"[object Object]"===e.toString()}function c(e,t=function(){}){return Object.keys(e).map(t)}function i(e,t){return t=Object.assign({},e,t),c(e,(r=>{s(e[r])&&s(t[r])&&(t[r]=Object.assign({},e[r],i(e[r],t[r])))})),t}function u(e){return[].concat([],e)}class a extends Error{constructor(e){super(e.message),Object.assign(this,e)}}function f(t,r,i,a,f){const p=[];return!f.strict||t&&c(t).length||p.push({message:`Property "${r}" can't be set in strict mode`,code:"strict"}),t.required&&f.empty(i)?(p.push({message:`Property "${r}" is "required"`,code:"required"}),p):t.readonly&&!a?(p.push({message:`Property '${r}' is 'readonly'`,code:"readonly"}),p):(void 0===i||(!t.type||!t.required&&f.empty(i)||o(t.type)&&s(i)||u(t.type).some((t=>function(t,r){const o=r&&r.toString().match(/^\s*function (\w+)/),s=(o?o[1]:"object").toLowerCase();if("date"===s&&t instanceof r)return!0;if("array"===s&&e(t))return!0;if("object"===s){if(n(r)&&t instanceof r)return!0;if(!n(r)&&typeof t===s)return!0}else if(typeof t===s)return!0;return!1}(i,t)))||p.push({message:`Property "${r}" has an invalid type "${typeof i}"`,code:"type"}),t.rule&&c(t.rule,(e=>{(0,t.rule[e])(i)&&p.push({message:`Property "${r}" breaks the "${e}" rule`,code:"rule:"+e})}))),p)}function p(e={},t,r){if(!e.type)return!1;const n=!!o(e.type)&&e.type,c=!!s(e.type)&&e.type;if(n||c){const o=n||l.create(t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").match(/[a-z]+/gi).map((e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())).join(""),c,r);return e.type=o,o}return!1}a.throw=function(e,t,r,n,o){const c=t.split(":")[0];if(!0===e.exceptions||s(e.exceptions)&&e.exceptions[c])throw new a({message:r,property:n,code:t,source:o&&o.constructor.name})};class l extends class{constructor(e,n){let o=!1;return new Proxy(this,{set(o,s,i){const u=e[s]||{},l=o[s],y=t(l),d=!(y||(h=i,$=l,JSON.stringify(h)===JSON.stringify($)));var h,$;const g=p(u,s,n);function m(t,r){return Reflect.apply(t,o,r||[s,i,l,e])}if(m(o.$onBeforeSet),d&&m(o.$onBeforeUpdate),r(u.transform)&&(i=m(u.transform,[i,e])),n.exceptions){const e=f(u,s,i,y,n);e.length&&a.throw(n,e[0].code,e[0].message,s,o)}return n.strict&&!c(u).length||(g&&(i=new g(i)),o[s]=i,m(o.$onSet),d&&m(o.$onUpdate)),!0},get(t,n){const s=e[n];let i=t[n];if("$eject"===n)return function(){let e={};return o=!0,e=function(e){return c(e=Object.assign({},e),(t=>{e[t]instanceof l&&(e[t]=e[t].eject())})),e}(t),o=!1,e};if(o)return i;if(!s)return t[n];function u(r,o){return Reflect.apply(r,t,o||[n,i,e])}return u(t.$onBeforeGet),r(s)&&(i=u(s,[t,e])),r(s.format)&&(i=u(s.format,[i,e])),u(t.$onGet),i},deleteProperty(t,r){const o=t[r];function s(n,s){return Reflect.apply(n,t,s||[r,o,e])}return(e[r]||{}).required&&a.throw(n,"required",`Property "${r}" is "required"`,r,t),s(t.$onBeforeDelete),Reflect.deleteProperty(t,r),s(t.$onDelete),s(t.$onUpdate),!0}})}}{constructor(e={},r={},n){super(e,n),c(e,(n=>{t(r[n])&&(this[n]=t(e[n].default)?r[n]:e[n].default)})),this.$patch(r)}$patch(e){c(e,(t=>{this[t]=e[t]}))}$put(e){c(this,(t=>{e[t]?o(this[t])?this[t].$put(e[t]):this[t]=e[t]:this.$delete(t)})),c(e,(t=>{this[t]||(this[t]=e[t])}))}$delete(e){Reflect.deleteProperty(this,e)}$onBeforeGet(){}$onBeforeSet(){}$onBeforeUpdate(){}$onDelete(){}$onGet(){}$onBeforeDelete(){}$onSet(){}$onUpdate(){}}l.settings={empty:e=>""===e||null===e||t(e),strict:!1,exceptions:{readonly:!1,required:!0,rule:!0,strict:!1,type:!0}},l.create=function(t,r,n,o){n=i(l.settings,n);const s={[t]:class extends l{constructor(e){super(r,e,n)}}}[t];return s.checkErrors=function(e,t){const o={};return c(r,(s=>{let c;const i=e[s],a=r[s],l=p(a,s,n);l&&(c=l.checkErrors(i,t));let y=f(a,s,i,!1,n);c?o[s]=c:y.length&&(t&&(y=y.filter((e=>!u(t).includes(e.code)))),y.length&&(o[s]=y))})),!!c(o).length&&o},s.hydrate=function(t){return e(t)?t.map((e=>new s(e))):new s(t)},Object.assign(s.prototype,o),s.schema=r,s};export default l;
